# Gitlab Server Setup

## Environment

- vitualbox 5.1.30
- ubuntu server 16.04.3
- 2-CPU 4G-RAM 50G-Disk

## Install

- install use downloaded package(recommend)

```bash
sudo apt-get install openssh-server

## email support, sendmail or exim is also OK
# sudo apt-get install postfix

sudo dpkg -i gitlab-ce_10.2.8-ce.0_amd64.deb
```

dpkg -i会需要一段时间，安装完成提示如下

![gitlab-setup](./images/gitlab-setup01.png)

使用默认配置启动gitlab server

```bash
sudo gitlab-ctl reconfigure
```

check install

```bash
sudo gitlab-ctl status
# or
sudo gitlab-ctl service-list
# or in browser
http://IP_ADDR
```

- install use apt-get

```bash
curl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash
sudo apt-get install gitlab-ce=10.2.8-ce.0
```

其他步骤参考downloaded package方式

## Directory structure

Omnibus-gitlab uses four different directories.

- ```/opt/gitlab``` holds application code for GitLab and its dependencies.
- ```/var/opt/gitlab``` holds application data and configuration files that gitlab-ctl reconfigure writes to.
- ```/etc/gitlab``` holds configuration files for omnibus-gitlab. These are the only files that you should ever have to edit manually.
- ```/var/log/gitlab``` contains all log data generated by components of omnibus-gitlab.

## Uninstalling

- when install use downloaded packages

```bash
# Stop gitlab and remove its supervision process
sudo gitlab-ctl uninstall

# Debian/Ubuntu
sudo dpkg -r gitlab
```

- when install use apt-get

```bash
sudo apt-get purge gitlab-ce
# sudo apt-get remove gitlab-ce

sudo rm -r /opt/gitlab/
sudo rm -r /var/opt/gitlab/
sudo rm -r /etc/gitlab/
sudo rm -r /var/log/gitlab/
```

## Reference

- [administration doc](https://docs.gitlab.com/ce/administration/index.html)
- [omnibus doc](https://docs.gitlab.com/omnibus/README.html)
- [omnibus-gitlab README](https://gitlab.com/gitlab-org/omnibus-gitlab/blob/6-9-stable/README.md)
- [default setting templete](https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template)
- [docker-ce packages](https://packages.gitlab.com/gitlab/gitlab-ce)
